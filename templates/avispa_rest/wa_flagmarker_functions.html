<script type="text/javascript">

    function change_flag(order,status){

        console.log(order+' '+status)

        var statusd = {};
        statusd['0000'] = 'empty'; //EMPTY
        statusd['0500'] = 'on hold'; //IN HOLD
        statusd['1000'] = 'Working on this'; //WORK IN PROGRESS
        statusd['2000'] = 'Ready for Review';
        statusd['2500'] = 'Under Revision';
        statusd['3000'] = 'Need work';
        statusd['4000'] = 'Approved';
        statusd['4500'] = 'Need update'; // FOR UPDATE AFTER APPROVE


        if(status=='0000'){
            $('#flagmenu_'+order+'_0000').css('display','inline').removeClass('bg-flag-selected')
            $('#flagmenu_'+order+'_0500').css('display','inline').removeClass('bg-flag-selected')
            $('#flagmenu_'+order+'_1000').css('display','none').removeClass('bg-flag-selected')
            $('#flagmenu_'+order+'_2000').css('display','none').removeClass('bg-flag-selected')
            $('#flagmenu_'+order+'_2500').css('display','none').removeClass('bg-flag-selected')
            $('#flagmenu_'+order+'_3000').css('display','none').removeClass('bg-flag-selected')
            $('#flagmenu_'+order+'_4000').css('display','none').removeClass('bg-flag-selected')
            $('#flagmenu_'+order+'_4500').css('display','none').removeClass('bg-flag-selected')
        }else if(status=='0500'){
            $('#flagmenu_'+order+'_0000').css('display','inline').removeClass('bg-flag-selected')
            $('#flagmenu_'+order+'_0500').css('display','inline').addClass('bg-flag-selected')
            $('#flagmenu_'+order+'_1000').css('display','inline').removeClass('bg-flag-selected')
            $('#flagmenu_'+order+'_2000').css('display','inline').removeClass('bg-flag-selected')
            $('#flagmenu_'+order+'_2500').css('display','inline').removeClass('bg-flag-selected')
            $('#flagmenu_'+order+'_3000').css('display','inline').removeClass('bg-flag-selected')
            $('#flagmenu_'+order+'_4000').css('display','inline').removeClass('bg-flag-selected')
            $('#flagmenu_'+order+'_4500').css('display','inline').removeClass('bg-flag-selected')
        }else if(status=='1000'){
            $('#flagmenu_'+order+'_0000').css('display','none').removeClass('bg-flag-selected')
            $('#flagmenu_'+order+'_0500').css('display','none').removeClass('bg-flag-selected')
            $('#flagmenu_'+order+'_1000').css('display','inline').addClass('bg-flag-selected')
            $('#flagmenu_'+order+'_2000').css('display','inline').removeClass('bg-flag-selected')
            $('#flagmenu_'+order+'_2500').css('display','none').removeClass('bg-flag-selected')
            $('#flagmenu_'+order+'_3000').css('display','none').removeClass('bg-flag-selected')
            $('#flagmenu_'+order+'_4000').css('display','none').removeClass('bg-flag-selected')
            $('#flagmenu_'+order+'_4500').css('display','none').removeClass('bg-flag-selected')
        }else if(status=='2000'){
            $('#flagmenu_'+order+'_0000').css('display','none').removeClass('bg-flag-selected')
            $('#flagmenu_'+order+'_0500').css('display','none').removeClass('bg-flag-selected')
            $('#flagmenu_'+order+'_1000').css('display','inline').removeClass('bg-flag-selected')
            $('#flagmenu_'+order+'_2000').css('display','inline').addClass('bg-flag-selected')
            $('#flagmenu_'+order+'_2500').css('display','inline').removeClass('bg-flag-selected')
            $('#flagmenu_'+order+'_3000').css('display','inline').removeClass('bg-flag-selected')
            $('#flagmenu_'+order+'_4000').css('display','inline').removeClass('bg-flag-selected')
            $('#flagmenu_'+order+'_4500').css('display','none').removeClass('bg-flag-selected')
        }else if(status=='2500'){
            $('#flagmenu_'+order+'_0000').css('display','none').removeClass('bg-flag-selected')
            $('#flagmenu_'+order+'_0500').css('display','none').removeClass('bg-flag-selected')
            $('#flagmenu_'+order+'_1000').css('display','none').removeClass('bg-flag-selected')
            $('#flagmenu_'+order+'_2000').css('display','none').removeClass('bg-flag-selected')
            $('#flagmenu_'+order+'_2500').css('display','inline').addClass('bg-flag-selected')
            $('#flagmenu_'+order+'_3000').css('display','inline').removeClass('bg-flag-selected')
            $('#flagmenu_'+order+'_4000').css('display','inline').removeClass('bg-flag-selected')
            $('#flagmenu_'+order+'_4500').css('display','none').removeClass('bg-flag-selected')
        }else if(status=='3000'){
            $('#flagmenu_'+order+'_0000').css('display','none').removeClass('bg-flag-selected')
            $('#flagmenu_'+order+'_0500').css('display','none').removeClass('bg-flag-selected')
            $('#flagmenu_'+order+'_1000').css('display','inline').removeClass('bg-flag-selected')
            $('#flagmenu_'+order+'_2000').css('display','inline').removeClass('bg-flag-selected')
            $('#flagmenu_'+order+'_2500').css('display','inline').removeClass('bg-flag-selected')
            $('#flagmenu_'+order+'_3000').css('display','inline').addClass('bg-flag-selected')
            $('#flagmenu_'+order+'_4000').css('display','inline').removeClass('bg-flag-selected')
            $('#flagmenu_'+order+'_4500').css('display','none').removeClass('bg-flag-selected')
        }else if(status=='4000'){
            $('#flagmenu_'+order+'_0000').css('display','none').removeClass('bg-flag-selected')
            $('#flagmenu_'+order+'_0500').css('display','none').removeClass('bg-flag-selected')
            $('#flagmenu_'+order+'_1000').css('display','none').removeClass('bg-flag-selected')
            $('#flagmenu_'+order+'_2000').css('display','none').removeClass('bg-flag-selected')
            $('#flagmenu_'+order+'_2500').css('display','none').removeClass('bg-flag-selected')
            $('#flagmenu_'+order+'_3000').css('display','inline').removeClass('bg-flag-selected')
            $('#flagmenu_'+order+'_4000').css('display','inline').addClass('bg-flag-selected')
            $('#flagmenu_'+order+'_4500').css('display','inline').removeClass('bg-flag-selected')
        }else if(status=='4500'){
            $('#flagmenu_'+order+'_0000').css('display','none').removeClass('bg-flag-selected')
            $('#flagmenu_'+order+'_0500').css('display','none').removeClass('bg-flag-selected')
            $('#flagmenu_'+order+'_1000').css('display','none').removeClass('bg-flag-selected')
            $('#flagmenu_'+order+'_2000').css('display','none').removeClass('bg-flag-selected')
            $('#flagmenu_'+order+'_2500').css('display','none').removeClass('bg-flag-selected')
            $('#flagmenu_'+order+'_3000').css('display','inline').removeClass('bg-flag-selected')
            $('#flagmenu_'+order+'_4000').css('display','inline').removeClass('bg-flag-selected')
            $('#flagmenu_'+order+'_4500').css('display','inline').addClass('bg-flag-selected')
        }



        $('#flag_'+order).val(status);  
        $('#flagmarker_'+order).removeClass().addClass('fc-'+status); 
        $('#flagtext_'+order).html(statusd[status]+'*');

    }

    $( ".fieldflag" ).click(function() {       
        var flag = $(this).attr('flag');
        var f = flag.split('_')

        change_flag(f[0],f[1]);

        //$('#live_'+f[0]).removeClass().addClass('label label-success').empty().append("Live on save"); 

    });

    $(".flag-aware").on("change paste", function() {
        console.log('The field '+$(this).attr('name')+' has changed its value to '+$(this).val()); 
        var order = $(this).attr('order');
        //if(isEmpty($(this.val))){
        if($(this).val()){
            change_flag(order,'1000');           
        } else {
            change_flag(order,'0000');
        }
    });
</script>

<script type="text/javascript">
$(window).load(function(){
    console.log("data.item==={{data.item}}")
    // This is to load existing values
    {% for field in data.fieldsschema %}
    console.log("Flag:{{field.FieldId}}_flag = {{data.item[field.FieldId+'_flag']}}");
        {%if field.FieldId+'_flag' in data.item %}
            {%if data.item[field.FieldId+'_flag']!='1' %}
    console.log("Flag exists, comes from DB = {{data.item[field.FieldId+'_flag']}}");
              {#% set flag = 0%#}
            {%else%}
    console.log('Flag exists but it is set as 1 ');
            {%endif%}
        {%else%}
    console.log('Flag doesnt even exist');
        {%endif%}

    change_flag({{field.FieldOrder}},{%if field.FieldId+'_flag' in data.item %}"{{data.item[field.FieldId+'_flag']}}"{%else%}"0000"{%endif%});
    {% endfor %}
});
</script>