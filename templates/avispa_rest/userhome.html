{% extends 'base.html' %}

{% block title %}
  My Ring - {{ title }}
{% endblock %}


{% block content %}

<!-- CONTENT HERE -->


<section>
    <div class="container-fluid">
        <div class="row">
            <div class="col-sm-3 omega">
                

                <div class="row pl-20" >
                    <div class="col-xs-4 col-sm-12">
                        {% if data.handle_profilepic %}
                        <img src="{%if data.cu_profilepic%}/_images/{{data.handle}}/t150/{{data.handle_profilepic}}_t150.jpg{%else%}/static/images/ph_user.gif{%endif%}" class="profile-1"> 
                        {%else%}
                        <img src="/static/images/ph_user.gif" class="profile-1"> 
                        {%endif%}
                    </div>
                    <div class="col-xs-8 col-sm-12">
                        {% if data.handle_actualname %} 
                        <h1 class="text-lead fw-300 "><span class="text-gray">{{data.handle_actualname}}</span><br/><span class="text-lgray pull-left fs-0-6">{{data.handle}}</span></h1><br/>
                        {% else %}
                        <h1 class="text-lead fw-300 "><span class="text-gray">{{data.handle}}</span><br/><span class="text-lgray pull-left fs-0-6"></span></h1><br/>
                        {% endif %}

                        <!-- <a class="btn btn-large btn-vader" href="javascript:void(0);" onclick="startIntro().setOption('showProgress', true);" style="text-align:center;"><i class="fa fa-play-circle fa-3x"></i> <br/>Start Tour </a> -->
                    </div>
                </div>
                <div class="row pl-20">
                    <br/>
                    <div class="bord-top bb-11 mr-70 ml-15 spa5"></div>
                    <div class="col-xs-12 hidden-xs">
                    
                        <span class="text-s1 text-lgray">Organizations</span>
                        <!-- <span class="dropdown">
                            <a class="dropdown-toggle text-s1" id="menu_{{collection}}" data-toggle="dropdown" aria-expanded="false">
                              Organizations
                              <span class="caret"></span>
                            </a>
                            <ul class="dropdown-menu" role="menu" aria-labelledby="menu_{{collection}}">
                              <li role="presentation"><a role="menuitem" tabindex="-1" href="/_orgregister">New Organization</a></li>
                              <li role="presentation" class="disabled"><a role="menuitem" tabindex="-1" href="#">  Join Orgs</a></li>
                              <li role="presentation" class="disabled"><a role="menuitem" tabindex="-1" href="#">Explore Orgs</a></li>
                            </ul>
                        </span> -->

                    </div>
                    <div class="col-xs-12 col-sm-12">
                        {% for organization in data.organizations %}
                            
                            <a href="/{{organization['handle']}}/_home" data-toggle="tooltip" title="{{organization['handle']}}"> 

                                <img src="{%if organization['profilepic'] %}/_images/{{organization['handle']}}/t75/{{organization['profilepic']}}_t75.jpg{%else%}/static/images/ph_org.gif{%endif%}" class="pic-org-1">

                            </a>
    
                        {% endfor %}
                    

                        
                        {% if 'post_a' in data.user_authorizations %}

                        <div style="width:40px; height:40px;">
                            <a href="/_orgregister" data-toggle="tooltip" title="Join or Create" class="hidden-xs"><div class="pic-org-1 blueprint"><i class="fa fa-plus"></i></div></a>
                        </div>

                        {%endif%}


                    </div>

                        
                    
                </div>
            </div>
            <div class="col-sm-9">
                <br/>
                <div class="rn-box-naked" style="background-color:rgba(255, 255, 255, 0.6);">
                {#{data.dac_totals}#}
                {#{data.dac_totals_date}#}
                {#{data.ring_counts}#}
                {#{data.total_items}#}
                    <div class="row">
                        <div class="col-sm-12 " id="step1">

                            <div id="usergraph" class="ugp-container">
                            </div>
                            <div class="lead fs-1 text-lgray hidden-xs" id="chisme" style="float:right;">
                                <a href="/" type="button" class="btn btn-default btn-xs pull-right margin-x-10" id="t002_4"><i class="fa fa-question-circle"></i></a>
                            </div>
                             <!-- To use the graph, just load "days" with an array full of numbers, the javascript will adapt to them This is a Work in Progress.. -->

                              <script>
                                daysx = [20, 0, 0, 40, 0, 50, 30, 25,15, 00, 20, 35,13,20, 15, 0, 0,20, 0, 0, 15,15, 10, 40, 35,70, 85,35, 20, 0, 5,7,0, 0, 2, 0,25, 33, 0, 65,90, 67,32, 60, 0, 5,7,20, 15, 30, 65,30, 50, 80, 55,95, 10, 60, 115,70,20, 15, 30, 65,20, 0, 50, 90,95, 126, 40, 35,70, 85,35, 20, 0, 5,7,0, 1, 2, 0,25, 33, 0, 65,90, 90,32, 60, 0, 5,7];
                                daysx = [30, 50, 80, 55,95, 10, 60, 115,70,20, 15, 30, 65,20, 0, 50, 90,95, 126, 40, 35,70, 85,35, 20, 0, 5,7,0, 1, 2, 0,25, 33, 0, 65,90, 90,32, 60, 0, 5,7];
                                daysx = [85,35, 20, 0, 5,7,0, 1, 2, 0,25, 33, 0, 65,90, 90,32, 60, 0, 5,7];
                                daysx = [ 33, 0, 65,90, 91,32, 60, 0, 5,7];
                                daysx = [3,5,7];
                                days = {{data.dac_totals}};


                                var length = days.length ,
                                  min = Math.min.apply(null, days),
                                  max = Math.max.apply(null, days),
                                  sum = days.reduce( function(total, num){ return total + num }, 0),
                                  avg = Math.round(sum / length) ;

                                  $("#chisme").append("<span> <strong>Items: </strong>"+ {{data.total_items}} +" | </span>");
                                  $("#chisme").append("<span> <strong>Points: </strong>"+ sum +" | </span>");
                                  $("#chisme").append("<span> <strong>Upload</strong> Average: "+ avg +" /day | </span>");
                                  $("#chisme").append("<span> Record: "+ max +" </span>");
                                  var i;
                                for (i = 0; i < days.length; i++) {
                                  //1 day more, to avoid problems with zero
                                  var d= parseInt(days[i]);
                                  var d1= parseInt(days[i]) + 1;
                                  var pcent= (d1 * 100) / max;
                                  //Setting opacity
                                  var opacity= (pcent +20) / 100;
                                  //Creating the day inside usergraph
                                    if (d != max) { 
                                      $("#usergraph").append("<div class='ugp' style='height: "+pcent + "%; opacity:"+ opacity + ";' data-toggle='tooltip' title=' " + d +"'></div>");
                                    }else{
                                      $("#usergraph").append("<div class='ugp ugp2' style='height: "+pcent + "%; opacity:"+ opacity + "; ' data-toggle='tooltip' title='Record: " + d +" <br/> Jan 23, 2015' id='t002_2'></div>");
                                    }  
                                }
                                //defining the witdth of div (amount of items / 100%)
                                var divisions = 100 / length +"%";
                                $('.ugp').css('width', divisions);
             
                              </script>

                            <!-- <div style="position:absolute; left:10px;">
                                <a class="btn btn-default btn-warning" href="javascript:void(0);" onclick="t002();" style="text-align:center;">Take Graph Tour &nbsp; &nbsp;<i class="fa fa-play-circle fa-2x"></i> </a>
                            </div> -->

                        </div>  
                    </div>
                </div>

                <div id="step3">
                <br/>
                <p class="text-lgray">Data Collections </p>

                    <div class="rn-box-naked-title" style="display:none;">
                        <div class="btn-group pull-right" role="group" style="padding-top:10px;">
                            <a href="/" type="button" class="btn btn-default btn-xs pull-right">
                                <i class="fa fa-question-circle"></i>
                            </a>

                        {% if 'post_a_x' in data.user_authorizations %}
                            <a href="/{{data.handle}}/_collections?rq=post" class="btn btn-vader btn-xs pull-right" data-toggle="tooltip" title="Create new collection" data-placement="top"><i class="fa fa-plus"></i></a>
                        {%endif%}

                          <div class="btn-group" role="group">
                            <button type="button" class="btn btn-default btn-xs dropdown-toggle" data-toggle="dropdown" aria-expanded="false">
                              Settings
                              <span class="caret"></span>
                            </button>
                            <ul class="dropdown-menu" role="menu">
                              <li>
                                {% if 'get_a_x' in data.user_authorizations %}
                                    <a href="/{{data.handle}}/_collections">
                                    All Collections</a>
                                {%endif%}</li>
                                {% for collection in data.collections.collectionlist %}  
                                    {% if collection.valid %}
                                        <li><a href="/{{ data.handle }}/_collections/{{ collection.collectionname }}?rq=put">{{ collection.collectionname }}</a></li>
                                    {% endif %}
                                {% endfor %}
                            </ul>
                          </div>
                        </div>

                        <strong>
                            <h4>Your Data Collections <span class="text-lgray"> 
                             ( {{ data.collections.collectionlist|length }} )
                            </span></h4>
                        </strong>
                    </div>

                    <div>
                        

                        {% for collection in data.collections.collectionlist %}  
                            {% if collection.valid %}

                            <div class="rn-box-naked-clear" style="padding:10px 10px 0 20px;">
                                <div class="row">
                                    <div class="col-xs-12 col-sm-3">
                                        <div class="bg-" style=" margin-bottom:-20px;">
                                            
                                            {{ ui.collection(data.handle,collection.collectionname,6,1,'1 day ago',data.user_authorizations) }}
                                            
                                        </div>
                                          
                                    
                                    </div>
                                    <div class="col-xs-12 col-sm-9">
                                        <table width="100%" border="0">
                                            <tr bgcolor="">
                                              <td colspan="3" style="padding:0 2px 0px 2px;">
                                                <table class="table table-striped table-bordered">
                                                  {% for ring in collection.rings %}
                                                      {% if not ring.invalid %}  
                                                        {{ ui.panel_collections(data.handle,collection.collectionname,ring.ringname, '#fce121', ring.count , '85', '',data.user_authorizations) }}
                                                      {%endif%}
                                                  {% endfor %}
                                                  {% if 'post_a' in data.user_authorizations %}
                                                      {{ ui.collection_item_add(data.handle,collection.collectionname) }} 
                                                  {%endif%}
                                                </table>
                                              </td>
                                            </tr>
                                        </table>
                                    </div>
                                    
                                </div>
                                
                                
                            </div>
                            {% endif %}
                        {% endfor %}
                        
                    </div>
                    {% if 'post_a_x' in data.user_authorizations %}
                        <a href="/{{data.handle}}/_collections?rq=post" class="btn btn-success btn-xs pull-right">New collection</a>
                    {%endif%}
                </div> 
            

                <!--div style="display:none;" id="step2"> 
                    <div class="rn-box-title">

                        <a href="/" type="button" class="btn btn-default btn-xs pull-right">
                        <i class="fa fa-question-circle"></i></a>
                        {#% if 'get_a' in data.user_authorizations %#}
                            <a href="/{{data.handle}}" type="button" class="btn btn-info btn-xs pull-right">
                            see all</a> 
                        {#%endif%#}
                    
                        {#% if 'post_a' in data.user_authorizations %#}
                            <a href="/{{data.handle}}?rq=post&n=10" class="btn btn-success btn-xs pull-right"><i class="fa fa-plus"></i></a>
                        {#%endif%#}

                        My Rings
                    </div>
                    <div class="rn-box-solo">
                        <table class="table table-striped table-condensed">
                            {#% for ring in data.rings.ringlist %#}

                                {#{ ui.panel_rings(ring.ringname, ring.ringorigin, data.handle, '#924ea0', ring.count, '36', '',data.handle+'/'+ring.ringname,data.user_authorizations) }#}

                            {#% endfor %#}

                            {#% if 'post_a' in data.user_authorizations %#}
                                <tr>
                                    <td colspan="2" align="right" style="vertical-align:top;">
                                    {#{ ui.icon_med('',"#28B62C") }#}
                                    </td>
                                    <td  style="vertical-align:middle; align:center; ">
                                        <a href="/{#{data.handle}#}?rq=post&n=10" class="btn btn-default btn-success">
                                            <i class="fa fa-plus"></i> &nbsp; Create New Ring
                                        </a>        
                                    </td>
                                    <td  style="vertical-align:middle; align:center; ">
                                    </td>
                                </tr>
                            {#%endif%#}
                        </table>                                  
                    </div>
                </div--> 
            </div><!-- close 6 alpha -->  
        </div><!-- close ROW--> 


                <!-- COLUMN 1 -->
        <!-- COLUMN 1 -->           
    </div> <!-- CLOSE CONTAINER -->
</section>

 
 <script type="text/javascript" src="{{ url_for('static',filename='js/intro.js') }}"></script>
     <script type="text/javascript">
      function startIntro(){
        var intro = introJs();
          intro.setOptions({
            steps: [
              {
                element: '#step1',
                intro: "<table><tr><td><h4 class='fs-9'>1 </h4></td><td><h3 class='lh-1'>This is your <br/><strong>User Graph</strong></h3></td></tr><tr><td colspan='2'><p>All your activity goes here</p></td></tr></table>"
              },
              {
                element: '#step2',
                intro: "<table><tr><td><h4 class='fs-9'>2 </h4></td><td><h3 class='lh-1'>Create your <br/><strong>first Ring</strong></h3></td></tr><tr><td colspan='2'><p>Ring is where you put all your data</p></td></tr></table>",
                position: 'right'
              },
              {
                element: '#step3',
                intro: "<table><tr><td><h4 class='fs-9'>3 </h4></td><td><h3 class='lh-1'>Create Rings<br/><strong>Collections</strong></h3></td></tr><tr><td colspan='2'><p>A Ring Collection contains a group of related Rings.</p></td></tr></table>",
                position: 'left'
              },
              {
                element: '#step4',
                intro: "<table><tr><td><h4 class='fs-9'>4 </h4></td><td><h3 class='lh-1'>Join or create an<br/><strong>Organization</strong></h3></td></tr><tr><td colspan='2'><p>An Organization is how various users contribute in  MyRing.</p></td></tr></table>",
                position: 'top'
              }
            ]
          });

          intro.start();
      }

      function t002(){
        var intro = introJs();
          intro.setOptions({
            steps: [
              {
                element: '#step1',
                intro: "<h3 class='lh-1'>This is the user graph</h3><p>Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua.",position: 'bottom'
              },
              {
                element: '#usergraph',
                intro: "<h3 class='lh-1'>This graph measures your activity in MyRing</h3><p>Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua.",
                position: 'bottom'
              },
              {
                element: '#t002_2',
                intro: "<h3 class='lh-1'>Each strip represents a day of activity</h3><p>Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua.",
                position: 'right'
              },
              {
                element: '#chisme',
                intro: "<h3 class='lh-1'>Your hard numbers</h3><p>Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua.",
                position: 'left'
              },
              {
                element: '#t002_4',
                intro: "<h3 class='lh-1'>Help</h3><p>This button activates this modal. In case you have further questions please visit our <a href='/'>knowledge base</a> or contact us at myring.io",
                position: 'left'
              }
              
            ]
          });

          intro.start();
      }
    </script>   
  
{% endblock %}

